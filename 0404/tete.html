<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>물품등록</title>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/bootstrap.min.css" />
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
</head>

<body>
	<div class="container">
        <div style="width:800px; margin:0 auto; padding: 50px; border:1px solid #efefef;">
        	<h3>이미지등록</h3>
        	<hr />
        	<form id="form" action="${pageContext.request.contextPath}/item/imagewrite.do" method="post"
        	enctype="multipart/form-data">
				<div class="row">
					<div class="form-floating mb-2">
						<input type="text" name="ino" id="ino"
							style="background-color: #efefef;" value="${ino}"
							class="form-control" readonly /> <label for="ino"
							class="form-label">물품번호</label>
					</div>
					<div class="form-floating mb-2">
						<img src="${pageContext.request.contextPath}/resources/images/images.png" 
							id="img" style="width:600px; height:600px; cursor:pointer;" onclick="clickImage()"> 
						<input type="file" name="file" id="file" class="form-control" 
							onchange="imageChange(this)"/> <!-- imageChange(this): 함수 -->
					</div>
					<div>
						<input type="button" value="등록" class="btn btn-primary" onclick="itemImageInsert()" /> 
							<a href="select.do" class="btn btn-success">목록으로</a>
					</div>
					
				</div>
			</form>
			<hr />
					
			<form id="form1" action="imagewritebatch.do?ino=${ino }" method="post"
			nctype="multipart/form-data">
			<c:forEach var="idx" begin="1" end="3" step="1">
				<img src="${pageContext.request.contextPath}/resources/images/images.png"
					class="imgs"
					style="width:50px; height:50px; cursor:pointer;"> 
					
				<input type="file" name="file[]" onchange="imageChangeBatch(this,'${idx-1}')"/> 
				<!-- imageChange(this): 함수 -->
				<br/>
			</c:forEach>
				<input type="button" value="일괄등록" class="btn btn-primary" onclick="itemImageBatch()"/> 
				<a href="select.do" class="btn btn-success">목록으로</a>
			</form>
		</div> 
	</div>
	
	<script>

	//document.getElementById("아이디");  id가 일치하는 1개 찾기
	//document.getElementsByName("name값"); name값이 일치하는 n개 찾기
	//document.getElementsByClassName("class값"); class값이 일치하는 n개 찾기
	//document.getElementsByTagName("img"); 태그가 img인 n개 찾기
		
		
		function imageChangeBatch(e, idx) {
			const imgs = document.getElementsByClassName("imgs");
			if(e.files.length>0){
				imgs[ Number(idx)].src=URL.createObjectURL( e.files[0] ); // 가상의 url정보를 생성
			}
			else{ //취소
				imgs[ Number(idx)].src = "${pageContext.request.contextPath}/resources/images/images.png";
			}
		}
		function insertImageBatch() {
			//유ㅎ성검사
			var chk = 0; 
			for(let i=0; i<imgs.length; i++){  // files전체 반복
				
				if(imgs[i].value.length <= 0){ // 첨부하지 않은 빈공간을 발견하면
					alert('이미지를 등록하세요.'); // 알림창을 띄우고
					chk = 1;
					break;
				}
			}
		function itemImageBatch() {
			
		}
			
			const file = document.getElementById("file");
			if(file.value.length <= 0){
				alert('이미지를 등록하세요.');
				return false;
			}
			
			// 전송시킴
			document.getElementById("form").submit(); //form태그내용물을 아이디로 찾아서 submit

		}
	
		function clickImage() {
			document.getElementById("file").click();
			
		}
	
		function imageChange(e) {
			const img = document.getElementById("img");
			console.log(e.files);

			if(e.files.length > 0){ // 첨부
				// 파일을 첨부하면 크롬에서 blob:http://1.237.... 
				console.log(URL.createObjectURL( e.files[0] ));
				img.src = URL.createObjectURL( e.files[0] ); // 가상의 url정보를 생성
			}
			else{ //취소
				img.src = "${pageContext.request.contextPath}/resources/images/images.png";
			}
		}

		function itemImageInsert() {
			// 유효성

			// 파일
			const file = document.getElementById("file");
			if(file.value.length <= 0){
				alert('이미지를 등록하세요.');
				return false;
			}
			
			// 전송시킴
			document.getElementById("form").submit(); //form태그내용물을 아이디로 찾아서 submit

		}
	
	</script>
</body>
</html>
